# Лабораторная работа №3

Веб-приложение для проверки попадания точки в заданную на графике область.

## Технологический стек
- **Java 17**
- **Jakarta EE 10 (CDI, JSF 4.0, JPA 3.1)**
- **PrimeFaces 12** - для UI компонентов
- **EclipseLink 4.0** - реализация JPA
- **PostgreSQL** - система управления базами данных
- **Gradle** - система автоматической сборки

## Структура проекта

### Слой представления (View)
- `start.xhtml` - стартовая страница с часами и ссылкой на основную страницу.
- `main.xhtml` - основная страница с формой ввода, интерактивным графиком и таблицей результатов.

### Слой контроллеров (Managed Beans)
- `StartPageBean` (`@RequestScoped`) - управляет данными на стартовой странице.
- `AreaCheckBean` (`@ViewScoped`) - обрабатывает данные формы (X, Y, R) и передает их для проверки.
- `ResultsBean` (`@SessionScoped`) - управляет списком результатов для отображения в таблице.

### Слой сервисов (Бизнес-логика)
- `AreaCalculationService` (`@ApplicationScoped`) - содержит логику проверки попадания точки в заданную область.
- `ResultService` (`@ApplicationScoped`) - координирует сохранение и получение результатов, работает как посредник между контроллерами и репозиторием.

### Слой репозитория (Доступ к данным)
- `ResultRepository` (`@ApplicationScoped`) - инкапсулирует всю логику взаимодействия с базой данных (сохранение, получение, удаление записей) с помощью JPA.

### Объекты для передачи данных (DTO)
- `ResultDTO` - "чистый" Java-объект для передачи данных между слоями, не привязанный к JPA.

### Сущности базы данных (Entity)
- `ResultEntity` - JPA-сущность, которая представляет собой запись в таблице результатов в базе данных.

### Мапперы
- `ResultMapper` - утилитарный класс для преобразования `ResultEntity` в `ResultDTO` и обратно.

### Валидаторы
- `XValidator` - JSF-валидатор для проверки корректности значения X (должен быть в диапазоне от -4 до 4).
- `YValidator` - JSF-валидатор для проверки корректности значения Y (должен быть в диапазоне от -5 до 5).
- `RValidator` - JSF-валидатор для проверки корректности значения R (должен быть в диапазоне от 0.1 до 3.0).

### Конфигурация приложения
- `Config` (`@ApplicationScoped`) - хранит константы приложения (разрешенные значения X, минимальные и максимальные значения Y).
- `CharacterEncodingFilter` - сервлет-фильтр для установки кодировки UTF-8 для всех запросов и ответов, предотвращает проблемы с отображением кириллицы и других символов.

### Фронтенд (JavaScript)
- `area.js` - главный скрипт для работы с интерактивным графиком:
  - Отрисовка координатной плоскости с осями и сеткой.
  - Отображение закрашенных областей (прямоугольник, треугольник, четверть круга) в зависимости от текущего значения R.
  - Интерактивный выбор точки (X, Y) при движении мыши по canvas.
  - Отображение всех проверенных точек из таблицы результатов на графике.
  - Динамическое масштабирование графика при изменении R.
  - Автоматическая отправка формы при клике на график.
  
- `clock.js` - скрипт для анимированных аналоговых часов на стартовой странице:
  - Отображение текущего времени, даты, дня недели.
  - Поддержка множества локалей (языков и форматов).
  - Плавная анимация вращения циферблатов.
  - Интерактивный выбор языка для отображения месяцев и дней недели.
  
- `main.js` - вспомогательные функции для основной страницы:
  - Функции для выбора значения X из кнопок.
  - Парсинг чисел с учетом локали (запятая и точка как десятичный разделитель).
  - Синхронизация состояния формы с графиком.

### Фронтенд (CSS)
- `reset.css` - базовые CSS-сбросы для унификации отображения в разных браузерах.
- `clock.css` - стили для анимированных часов на стартовой странице (циферблаты, вращение, диалог выбора языка).
- `main.css` - основные стили приложения:
  - Современный дизайн с градиентами и тенями.
  - Адаптивная сетка для размещения формы и графика.
  - Стилизация формы, кнопок, таблицы результатов.
  - Стили для canvas с графиком.
  - Responsive-дизайн для мобильных устройств.

### Файлы конфигурации
- `faces-config.xml` - правила навигации JSF между страницами.
- `persistence.xml` - конфигурация подключения к базе данных PostgreSQL через EclipseLink (JPA-провайдер).
- `beans.xml` - маркерный файл для активации CDI (Contexts and Dependency Injection).
- `web.xml` - дескриптор развертывания веб-приложения:
  - Настройка JSF Servlet.
  - Регистрация `CharacterEncodingFilter` для корректной работы с UTF-8.
  - Определение стартовой страницы.

## Архитектура приложения

Приложение построено на классической многослойной архитектуре, что обеспечивает хорошее разделение ответственности и упрощает поддержку и тестирование.

**1. View (JSF)**: Пользовательский интерфейс, созданный с помощью JSF и PrimeFaces. Отвечает за отображение данных и прием ввода от пользователя.

**2. Controller (Managed Beans)**: Получает данные от View, минимально их обрабатывает и передает в слой сервисов. Не содержит бизнес-логики.

**3. Service**: Содержит основную бизнес-логику приложения (например, расчет попадания точки). Координирует работу между контроллерами и репозиторием.

**4. Repository**: Единственный слой, который напрямую работает с базой данных через JPA. Выполняет CRUD-операции (создание, чтение, удаление).

**5. DTO/Entity/Mapper**: Слои для представления данных. `Entity` для БД, `DTO` для передачи между слоями, `Mapper` для их преобразования.

### Поток данных при проверке точки

1.  **Пользователь** вводит данные в форму на `main.xhtml` и нажимает "Проверить".
2.  **AreaCheckBean** (Controller) получает значения X, Y, R.
3.  `AreaCheckBean` вызывает **AreaCalculationService** (Service) для проверки попадания.
4.  `AreaCheckBean` создает **ResultDTO** с результатами и передает его в **ResultsBean**.
5.  **ResultsBean** вызывает **ResultService** для сохранения результата.
6.  **ResultService** использует **ResultMapper** для конвертации `ResultDTO` в `ResultEntity`.
7.  `ResultService` передает `ResultEntity` в **ResultRepository** (Repository), который сохраняет его в базу данных PostgreSQL.
8.  Таблица на странице обновляется, отображая новый результат.

